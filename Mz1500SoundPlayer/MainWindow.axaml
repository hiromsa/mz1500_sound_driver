<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Mz1500SoundPlayer"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="Mz1500SoundPlayer.MainWindow"
        x:DataType="local:MainWindow"
        xmlns:AvaloniaEdit="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
        Title="Mz1500SoundPlayer"
        Background="#1e1e1e" Foreground="#d4d4d4">
  <DockPanel>
    <!-- Top Menu -->
    <Menu DockPanel.Dock="Top" Background="#333333">
      <MenuItem Header="_File">
        <MenuItem Header="Load MML" Click="LoadMmlButton_Click"/>
        <MenuItem Header="Save MML" Click="SaveMmlButton_Click"/>
        <Separator/>
        <MenuItem Header="Import MIDI" Click="LoadMidiButton_Click"/>
        <MenuItem Header="Import FMS" Click="LoadFmsButton_Click"/>
        <MenuItem Header="Export QDC (.qdc)" Click="ExportQdcButton_Click"/>
        <Separator/>
        <MenuItem Header="Exit" Click="Exit_Click"/>
      </MenuItem>
      <MenuItem Header="_Edit">
        <MenuItem Header="Remap Channels" Click="RemapButton_Click"/>
        <MenuItem Header="Clear Text" Click="ClearButton_Click"/>
      </MenuItem>
    </Menu>

    <!-- 2-Column layout: Left for Editor, Right for Controls -->
    <Grid Margin="15" ColumnDefinitions="*, 250" RowDefinitions="Auto, *, Auto">
      
      <!-- LEFT PANEL -->
      <TextBlock Grid.Row="0" Grid.Column="0" Text="MZ-1500 Sound Player" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5" Foreground="#cccccc"/>
      <TextBlock Grid.Row="0" Grid.Column="0" Text="MMLã‚’å…¥åŠ›ã—ã¦Playãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„:" Margin="5,25,0,5" Foreground="#858585"/>

      <AvaloniaEdit:TextEditor Grid.Row="1" Grid.Column="0" Name="MmlInput" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" WordWrap="True" FontFamily="Consolas" ShowLineNumbers="True" Margin="0,0,15,5"
               Background="#1e1e1e" Foreground="#d4d4d4"
               Text="; ZELDA OP (Converted from MZSoundDriverProject VB source)&#x0d;&#x0a;; Note: Noise commands (zt/zs) and Pitch Envelopes (EP) are currently unsupported and have been removed.&#x0d;&#x0a;&#x0d;&#x0a;@v0 = {12, 12, 12, 13, 13, 13, 14, 14, 14, 15, 15, 15, 15, 15, 14, 14, 14, 14, 14, 13, 13, 13, 13, 13, 12, 12, 12, 12, 12, 11, 11, 11, 11, 11, 10, 10, 10, 10, 10}&#x0d;&#x0a;@v1 = {13, 13, 10, 10, 11, 12, 13, 13, 13, 13, 12, 12, 12, 12, 11, 11, 11, 11, 11, 10, 10, 10, 10, 10}&#x0d;&#x0a;&#x0d;&#x0a;ABCDE t144&#x0d;&#x0a;&#x0d;&#x0a;A o4 @v0 l8 b-2 r f f b- a-16 g-16 a-8^4 r2 b-2 r g- g- b- a16 g16 a8^4 r2 r&#x0d;&#x0a;B o3 @v1 l4 &lt;b-&gt; r r2 &lt;a-&gt; r r2 &lt;g-&gt; r r2 &lt;f&gt; r r2 r&#x0d;&#x0a;C o4 @v0 l8 d2^8 d d d c16 c16 c8^2^8 r c+2^8 c+ c+ c+ c16 c16 c8^2^4 r&#x0d;&#x0a;D o3 @v1 l4 &lt;r&gt; f b-2 &lt;r&gt; e- a-2 &lt;r&gt; d- g-2 &lt;r&gt; c f2 r&#x0d;&#x0a;E v14 o2 l1 b- a- g- f r">
        <AvaloniaEdit:TextEditor.ContextMenu>
          <ContextMenu Opening="MmlInput_ContextMenuOpening">
            <MenuItem Name="MenuEditEnvelope" Header="ã‚«ãƒ¼ã‚½ãƒ«è¡Œã®ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—ã‚’ç·¨é›†..." Click="EditEnvelope_Click"/>
            <MenuItem Name="MenuNewVolEnvelope" Header="æ–°è¦éŸ³é‡ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—(@v)ã®æŒ¿å…¥..." Click="NewVolEnvelope_Click"/>
            <MenuItem Name="MenuNewPitchEnvelope" Header="æ–°è¦éŸ³é«˜ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—(@EP)ã®æŒ¿å…¥..." Click="NewPitchEnvelope_Click"/>
            <Separator/>
            <MenuItem Header="é¸æŠžç¯„å›²ã®MMLã‚’ç·¨é›† (Ctrl+E)" Click="EditMmlSelection_Click"/>
            <MenuItem Header="é¸æŠžç¯„å›²ã®MMLã‚’æ•´å½¢ (ãƒ•ã‚©ãƒ¼ãƒžãƒƒã‚¿)..." Click="FormatMmlSelection_Click"/>
          </ContextMenu>
        </AvaloniaEdit:TextEditor.ContextMenu>
      </AvaloniaEdit:TextEditor>
      
      <!-- Logging / Status -->
      <TextBlock Grid.Row="2" Grid.Column="0" Name="LogOutput" Foreground="#4FC1FF" TextWrapping="Wrap" HorizontalAlignment="Stretch" Margin="0,5,0,0"/>

      <!-- RIGHT PANEL: Controls wrapped in ScrollViewer -->
      <ScrollViewer Grid.Row="0" Grid.RowSpan="3" Grid.Column="1" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="10" Margin="5,0,0,5" Background="#252526">
          
          <!-- Playback Group -->
          <Border BorderBrush="#3c3c3c" BorderThickness="1" CornerRadius="4" Padding="10">
            <StackPanel Spacing="5">
              <TextBlock Text="â–¶ï¸ Playback" FontWeight="Bold" Foreground="#cccccc" Margin="0,0,0,5"/>
              <StackPanel Orientation="Horizontal" Spacing="5" Margin="0,0,0,5" HorizontalAlignment="Center">
                <TextBlock Text="Vol:" VerticalAlignment="Center" Foreground="#cccccc"/>
                <Slider Name="MasterVolumeSlider" Minimum="0" Maximum="1" Value="0.5" Width="140" VerticalAlignment="Center" ValueChanged="MasterVolumeSlider_ValueChanged"/>
              </StackPanel>
              
              <CheckBox Name="ChkMetronome" Content="Metronome (Sync Tr.A)" IsChecked="False" Checked="ChkMetronome_Changed" Unchecked="ChkMetronome_Changed" Margin="0,0,0,5" Foreground="#cccccc"/>

              <StackPanel Orientation="Vertical" Spacing="2" Margin="0,0,0,10">
                <CheckBox Name="ChkAll" Content="ALL" IsChecked="True" Checked="ChkAll_Changed" Unchecked="ChkAll_Changed" Foreground="#d4d4d4" Margin="0,0,0,5"/>
                
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkA" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="A â™¬" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeA}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="LimeGreen"/>
                </Grid>
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkB" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="B â™¬" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeB}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="LimeGreen"/>
                </Grid>
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkC" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="C â™¬" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeC}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="LimeGreen"/>
                </Grid>
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkD" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="D ðŸ¥" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeD}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="DarkOrange"/>
                </Grid>
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkE" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="E â™¬" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeE}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="LimeGreen"/>
                </Grid>
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkF" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="F â™¬" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeF}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="LimeGreen"/>
                </Grid>
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkG" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="G â™¬" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeG}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="LimeGreen"/>
                </Grid>
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkH" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="H ðŸ¥" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeH}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="DarkOrange"/>
                </Grid>
                <Grid ColumnDefinitions="Auto, Auto, *" Margin="0,0,0,2">
                  <CheckBox Name="ChkP" IsChecked="True" Checked="ChkChannel_Changed" Unchecked="ChkChannel_Changed" Grid.Column="0"/>
                  <TextBlock Text="P ðŸ“¢" Foreground="White" VerticalAlignment="Center" Margin="5,0,15,0" Grid.Column="1"/>
                  <ProgressBar MinWidth="0" Minimum="0" Maximum="15" Value="{Binding CurrentVolumeP}" Height="10" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="0,0,20,0" Grid.Column="2" Foreground="MediumOrchid"/>
                </Grid>
              </StackPanel>

              <Button Name="PlayMmlButton" Content="Play" Click="PlayMmlButton_Click" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Background="#0e639c" Foreground="#ffffff" FontWeight="Bold" Margin="0,5,0,0"/>
              <Button Name="StopButton" Content="Stop" Click="StopButton_Click" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Background="#8c2f2f" Foreground="#ffffff"/>
            </StackPanel>
          </Border>

          <!-- PCG Image Group -->
          <Border BorderBrush="#3c3c3c" BorderThickness="1" CornerRadius="4" Padding="10">
            <StackPanel Spacing="5">
              <TextBlock Text="PCG Image (320x200 8color)" Foreground="#cccccc" FontWeight="Bold" Margin="0,0,0,5"/>
              <Grid ColumnDefinitions="*, *, Auto">
                <Button Name="LoadPcgImageButton" Content="Load File..." Click="LoadPcgImageButton_Click" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Grid.Column="0" Margin="0,0,5,0"/>
                <Button Name="PastePcgImageButton" Content="Paste" Click="PastePcgImageButton_Click" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Grid.Column="1" Margin="0,0,5,0"/>
                <Button Name="ClearPcgImageButton" Content="Clear" Click="ClearPcgImageButton_Click" Grid.Column="2"/>
              </Grid>
              <Border Background="#1e1e1e" BorderBrush="#333333" BorderThickness="1" CornerRadius="2" Margin="0,5,0,0" Height="140" HorizontalAlignment="Stretch">
                <Image Name="PcgImagePreview" Stretch="Uniform"/>
              </Border>
            </StackPanel>
          </Border>

        </StackPanel>
      </ScrollViewer>
    </Grid>
  </DockPanel>
</Window>
